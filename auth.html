<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Distansia ‚Äî Kirish / Ro'yxatdan o'tish</title>
  <style>
    :root{--primary:#4f46e5;--muted:#6b7280}
    html,body{height:100%;}
    body{font-family:Inter,Segoe UI,Arial,sans-serif; background:linear-gradient(180deg,#eef2ff 0%, #ffffff 60%); color:#111; display:flex; align-items:center; justify-content:center; padding:18px}
  /* Make the auth card cover the entire window and center its inner content */
  .card{background:linear-gradient(180deg,#fff,#fbfdff); padding:28px; border-radius:0; width:100vw; height:100vh; box-shadow:none; border:0; box-sizing:border-box}
  .content{flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; max-width:760px; margin:0 auto; width:100%; padding:12px}
    .header{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
    .brand{display:flex; align-items:center; gap:10px}
    .logo { width:36px; height:36px; display:block }
    h2{font-size:18px; margin:0}
    .close{background:transparent;border:none;font-size:18px;cursor:pointer;color:var(--muted)}

  .tabs{display:flex; gap:8px; margin:12px 0 14px; width:100%}
    .tab{flex:1;text-align:center;padding:9px 10px;border-radius:8px;cursor:pointer;background:#f3f4f6;color:var(--muted);font-weight:600}
    .tab.active{background:var(--primary); color:#fff}

  form{display:block; width:100%; max-width:560px}
  /* Fields: ensure inputs grow to full width and are visually larger */
  .field{display:flex; align-items:center; gap:8px; margin:10px 0}
  input{flex:1; min-width:0; padding:12px 14px; border-radius:10px; border:1px solid #e6e9f2; background:#fff; font-size:16px}
    .pw-toggle{background:transparent;border:none;cursor:pointer;color:var(--muted);font-size:14px}

  .actions{display:flex; gap:12px; margin-top:14px}
  .btn{flex:1;padding:12px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-outline{background:transparent;border:1px solid var(--primary);color:var(--primary)}

  .google{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:14px;padding:12px;border-radius:8px;background:#fff;border:1px solid #e5e7eb;cursor:pointer}
  .google svg{width:18px;height:18px}

    .msg{height:18px;margin:8px 0 0;color:#b91c1c;font-size:13px}
    .success{color:#065f46}
    .small{font-size:13px;color:var(--muted);margin-top:10px;text-align:center}

    @media (max-width:768px){
      .card{padding:18px;width:100%}
      .tabs{gap:6px}
      input{font-size:15px}
      .btn{font-size:15px}
    }
  </style>
</head>
<body>
  <div class="card" role="dialog" aria-modal="true" aria-label="Authentication">
    <div class="header">
      <div class="brand">
        <!-- simple inline SVG mark -->
        <svg class="logo" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#4f46e5"/>
              <stop offset="1" stop-color="#7c3aed"/>
            </linearGradient>
          </defs>
          <rect width="48" height="48" rx="10" fill="url(#g)"/>
          <text x="50%" y="54%" text-anchor="middle" font-size="20" font-family="Arial" fill="#fff" font-weight="700">D</text>
        </svg>
        <h2>Distansia</h2>
      </div>
      <button class="close" id="closeBtn" aria-label="Close">‚úï</button>
    </div>

    <div class="content">
    <div class="tabs" role="tablist">
      <div id="tabLogin" class="tab active" role="tab" aria-selected="true">Kirish</div>
      <div id="tabRegister" class="tab" role="tab">Ro'yxatdan o'tish</div>
    </div>

    <form id="loginForm">
      <div class="field"><input id="loginEmail" type="email" placeholder="Email" required autocomplete="username" /></div>
      <div class="field"><input id="loginPassword" type="password" placeholder="Parol" required autocomplete="current-password" /><button type="button" class="pw-toggle" id="toggleLoginPw">üëÅ</button></div>
      <div style="display:flex; align-items:center; gap:10px; margin-top:6px;">
        <label style="font-size:14px; color:var(--muted)"><input type="checkbox" id="rememberMe" style="margin-right:6px;"> Eslab qolish</label>
      </div>
      <div class="actions">
        <button class="btn btn-primary" type="submit">Kirish</button>
        <button id="toRegister" type="button" class="btn btn-outline">Ro'yxatdan o'tish</button>
      </div>
      <p id="loginMsg" class="msg" aria-live="polite"></p>
    </form>

    <form id="registerForm" style="display:none;">
      <div class="field"><input id="regFirstName" type="text" placeholder="Ism" required autocomplete="given-name" /></div>
      <div class="field"><input id="regLastName" type="text" placeholder="Familiya" required autocomplete="family-name" /></div>
  <div class="field"><input id="regAge" type="number" placeholder="Yosh" min="12" max="90" /></div>
  <div class="field"><input id="regPhone" type="tel" placeholder="Telefon (masalan +998901234567)" pattern="^\+998\d{9}$" maxlength="13" /></div>
      <div class="field"><input id="regEmail" type="email" placeholder="Email" required autocomplete="email" /></div>
      <div class="field"><input id="regPassword" type="password" placeholder="Parol (kamida 6 belgidan)" required autocomplete="new-password" /><button type="button" class="pw-toggle" id="toggleRegPw">üëÅ</button></div>
      <div class="field"><input id="regAddress" type="text" placeholder="Manzil (shahar, manzil)" /></div>
      <div class="actions">
        <button class="btn btn-primary" type="submit">Ro'yxatdan o'tish</button>
      </div>
      <p id="regMsg" class="msg" aria-live="polite"></p>
    </form>

    <div style="text-align:center; margin-top:6px; color:var(--muted);">yoki</div>
    <button id="googleBtn" class="google" aria-label="Sign in with Google">
      <!-- Google G icon (simple multi-color SVG) -->
      <svg viewBox="0 0 46 46" xmlns="http://www.w3.org/2000/svg" role="img" aria-hidden="true">
        <path d="M23 11c2.5 0 4.5.9 6 2.1l4.5-4.5C31.5 6 27.6 4 23 4 14.8 4 8.1 9.5 5 17l5.2 4C12.2 14.5 17 11 23 11z" fill="#EA4335"/>
        <path d="M42 23c0-1.5-.1-2.6-.4-3.8H23v7.2h10.8c-.5 2.7-2.5 5-5.3 6.5l5 3.9C39.6 34.6 42 29.2 42 23z" fill="#34A853"/>
        <path d="M10.2 28.1C9.3 26.5 8.8 24.7 8.8 23c0-1.7.5-3.5 1.4-5.1L5 13c-2 3.6-3.2 7.8-3.2 12s1.2 8.4 3.2 12l5.2-4.9z" fill="#FBBC05"/>
        <path d="M23 42c4.6 0 8.5-1.6 11.3-4.4l-5-3.9c-1.5 1.1-3.6 1.8-6.3 1.8-6 0-10.8-3.5-12.8-8.7L5 33c3.1 7.5 9.8 13 18 13z" fill="#4285F4"/>
      </svg>
      Google bilan kirish
    </button>

    <div class="small">Ro'yxatdan o'tish bilan siz <strong>qoidalar</strong> va <strong>maxfiylik siyosati</strong>ni qabul qilasiz.</div>
    </div>
  </div>

<script>
// Keep the same simple localStorage auth logic and add password toggles
const AUTH_KEY = 'distansia_users';
const CURR_KEY = 'distansia_currentUser';
function readUsers(){ try{ return JSON.parse(localStorage.getItem(AUTH_KEY)) || []; }catch(e){return [];} }
function writeUsers(u){ localStorage.setItem(AUTH_KEY, JSON.stringify(u)); }
function setCurrentUser(user){ localStorage.setItem(CURR_KEY, JSON.stringify(user)); }
function readRemember(){ try { return JSON.parse(localStorage.getItem('distansia_remember')) || null; } catch(e){ return null; } }
function writeRemember(obj){ if(!obj) localStorage.removeItem('distansia_remember'); else localStorage.setItem('distansia_remember', JSON.stringify(obj)); }

const tabLogin = document.getElementById('tabLogin');
const tabRegister = document.getElementById('tabRegister');
const loginForm = document.getElementById('loginForm');
const registerForm = document.getElementById('registerForm');
const toRegister = document.getElementById('toRegister');
const toLogin = document.getElementById('toLogin');
const closeBtn = document.getElementById('closeBtn');
const googleBtn = document.getElementById('googleBtn');
const loginMsg = document.getElementById('loginMsg');
const regMsg = document.getElementById('regMsg');
const toggleLoginPw = document.getElementById('toggleLoginPw');
const toggleRegPw = document.getElementById('toggleRegPw');

function showLogin(){ tabLogin.classList.add('active'); tabRegister.classList.remove('active'); loginForm.style.display='block'; registerForm.style.display='none'; }
function showRegister(){ tabLogin.classList.remove('active'); tabRegister.classList.add('active'); loginForm.style.display='none'; registerForm.style.display='block'; }

if (tabLogin) tabLogin.addEventListener('click', showLogin);
if (tabRegister) tabRegister.addEventListener('click', showRegister);
if (toRegister) toRegister.addEventListener('click', showRegister);
if (toLogin) toLogin.addEventListener('click', showLogin);

// If auth.html is used as a full page, close should go home
if (closeBtn) closeBtn.addEventListener('click', ()=> { window.location.href = 'index.html'; });

if (registerForm) registerForm.addEventListener('submit', (e)=>{
  e.preventDefault();
  const firstName = document.getElementById('regFirstName').value.trim();
  const lastName = document.getElementById('regLastName').value.trim();
  const age = document.getElementById('regAge').value;
  const phone = document.getElementById('regPhone').value.trim();
  const email = document.getElementById('regEmail').value.trim().toLowerCase();
  const password = document.getElementById('regPassword').value;
  const address = document.getElementById('regAddress').value.trim();
  if(!email||!password||!firstName||!lastName){ regMsg.textContent = 'Iltimos, ism, familiya, email va parolni kiriting.'; return; }
  if(password.length < 6){ regMsg.textContent = 'Parol kamida 6 belgidan iborat bo\'lishi kerak.'; return; }
  // age validation: students must be at least 12
  if(age){ const ageNum = Number(age); if(isNaN(ageNum) || ageNum < 12){ regMsg.textContent = 'Talaba yoshi kamida 12 bo\'lishi kerak.'; return; } }
  // phone validation: must start with +998 and have 9 digits after it (Uzbek full number, operator 2 digits + subscriber 7 digits)
  if(phone){ const p = phone.replace(/\s+/g,''); if(!/^\+998\d{9}$/.test(p)){ regMsg.textContent = 'Telefon +998XXXXXXXXX formatida bo\'lishi kerak (masalan +998901234567).'; return; } }
  const users = readUsers();
  if(users.find(u=>u.email === email)){ regMsg.textContent = 'Bu email bilan ro\'yxatdan o\'tilgan.'; return; }
  const newUser = { firstName, lastName, age, phone, address, email, password, name: firstName + (lastName ? (' ' + lastName) : '') };
  users.push(newUser); writeUsers(users); setCurrentUser(newUser);
  regMsg.classList.add('success'); regMsg.textContent = 'Muvaffaqiyatli!';
  setTimeout(()=>{ window.location.href = 'profile.html'; },800);
});

if (loginForm) loginForm.addEventListener('submit',(e)=>{
  e.preventDefault();
  const email = document.getElementById('loginEmail').value.trim().toLowerCase();
  const password = document.getElementById('loginPassword').value;
  const remember = document.getElementById('rememberMe') ? document.getElementById('rememberMe').checked : false;
  const users = readUsers();
  const found = users.find(u=>u.email===email && u.password===password);
  if(!found){ loginMsg.textContent = 'Email yoki parol noto\'g\'ri.'; return; }
  // Save current user (store full user object)
  setCurrentUser(found);
  // remember credentials if requested
  if(remember){ writeRemember({ email, password }); } else { writeRemember(null); }
  loginMsg.classList.add('success'); loginMsg.textContent = 'Kirish muvaffaqiyatli.';
  setTimeout(()=>{ window.location.href = 'profile.html'; },600);
});

// Google button: open Google's sign-in page (not an OAuth flow for the app) as a convenience.
if (googleBtn) googleBtn.addEventListener('click', ()=>{ window.open('https://accounts.google.com/signin','_blank'); });

// Password visibility toggles
if(toggleLoginPw){ toggleLoginPw.addEventListener('click', ()=>{
  const pw = document.getElementById('loginPassword'); pw.type = pw.type === 'password' ? 'text' : 'password';
  toggleLoginPw.textContent = pw.type === 'password' ? 'üëÅ' : 'üôà';
}); }
if(toggleRegPw){ toggleRegPw.addEventListener('click', ()=>{
  const pw = document.getElementById('regPassword'); pw.type = pw.type === 'password' ? 'text' : 'password';
  toggleRegPw.textContent = pw.type === 'password' ? 'üëÅ' : 'üôà';
}); }

// Prefill remembered credentials if present
try{
  const rem = readRemember();
  if(rem && document.getElementById('loginEmail')){
    document.getElementById('loginEmail').value = rem.email || '';
    document.getElementById('loginPassword').value = rem.password || '';
    const chk = document.getElementById('rememberMe'); if(chk) chk.checked = true;
  }
}catch(e){ /* ignore */ }

</script>
</body>
</html>